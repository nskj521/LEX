# Uninstall Script
if(NOT EXISTS "@CMAKE_INSTALL_MANIFEST_FILE@")
    message(WARNING "Cannot find install manifest: @CMAKE_INSTALL_MANIFEST_FILE@")
    message(STATUS "Attempting to remove binary from known locations...")

    set(POSSIBLE_LOCATIONS
        "@CMAKE_INSTALL_FULL_BINDIR@/@PROJECT_NAME@"
        "/usr/local/bin/@PROJECT_NAME@"
        "/usr/bin/@PROJECT_NAME@"
        "${CMAKE_INSTALL_PREFIX}/bin/@PROJECT_NAME@"
    )

    set(FOUND_ANY FALSE)
    foreach(location ${POSSIBLE_LOCATIONS})
        if(EXISTS "${location}")
            message(STATUS "Removing: ${location}")
            execute_process(
                COMMAND ${CMAKE_COMMAND} -E remove "${location}"
                RESULT_VARIABLE result
            )
            if(result EQUAL 0)
                message(STATUS "  ✓ Removed successfully")
                set(FOUND_ANY TRUE)
            else()
                message(WARNING "  ✗ Failed to remove (may need sudo)")
            endif()
        endif()
    endforeach()

    if(NOT FOUND_ANY)
        message(STATUS "No installed files found. Try 'sudo make force-uninstall' if binary remains.")
    endif()
    return()
endif()

# Read manifest and remove files
file(READ "@CMAKE_INSTALL_MANIFEST_FILE@" files)
string(REGEX REPLACE "\n" ";" files "${files}")

set(SUCCESS_COUNT 0)
set(FAILURE_COUNT 0)
set(MISSING_COUNT 0)

foreach(file ${files})
    message(STATUS "Uninstalling: ${file}")
    if(NOT EXISTS "${file}")
        message(STATUS "  - File not found (already removed?)")
        math(EXPR MISSING_COUNT "${MISSING_COUNT} + 1")
        continue()
    endif()

    execute_process(
        COMMAND ${CMAKE_COMMAND} -E remove "${file}"
        RESULT_VARIABLE result
        OUTPUT_QUIET ERROR_QUIET
    )

    if(EXISTS "${file}")
        message(WARNING "  ✗ Failed to remove (may need sudo)")
        math(EXPR FAILURE_COUNT "${FAILURE_COUNT} + 1")
    else()
        message(STATUS "  ✓ Removed successfully")
        math(EXPR SUCCESS_COUNT "${SUCCESS_COUNT} + 1")
    endif()
endforeach()

message(STATUS "")
message(STATUS "=== Uninstall Summary ===")
message(STATUS "Successfully removed: ${SUCCESS_COUNT} file(s)")
if(MISSING_COUNT GREATER 0)
    message(STATUS "Already missing: ${MISSING_COUNT} file(s)")
endif()
if(FAILURE_COUNT GREATER 0)
    message(WARNING "Failed to remove: ${FAILURE_COUNT} file(s)")
    message(WARNING "You may need to run with sudo: sudo make uninstall")
endif()
message(STATUS "========================")

# Backup locations
message(STATUS "")
message(STATUS "Double-checking common install locations...")
set(BACKUP_LOCATIONS
    "/usr/local/bin/@PROJECT_NAME@"
    "/usr/bin/@PROJECT_NAME@"
)

foreach(location ${BACKUP_LOCATIONS})
    if(EXISTS "${location}")
        message(STATUS "Found binary at: ${location}")
        execute_process(
            COMMAND ${CMAKE_COMMAND} -E remove "${location}"
            RESULT_VARIABLE result
            OUTPUT_QUIET ERROR_QUIET
        )
        if(NOT EXISTS "${location}")
            message(STATUS "  ✓ Removed successfully")
        else()
            message(WARNING "  ✗ Failed to remove (need sudo)")
        endif()
    endif()
endforeach()

message(STATUS "Uninstall complete!")
